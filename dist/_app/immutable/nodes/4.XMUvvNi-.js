import"../chunks/Bzak7iHL.js";import{d as xe,s as M,o as Ce,a as Se}from"../chunks/CEdD1vL5.js";import{a3 as ye,a5 as w,a6 as te,a9 as r,aa as a,ad as d,ab as ae,l as be,a7 as m,a8 as ke,F as Ne,a4 as H,J as t,R as h,ac as we}from"../chunks/B-Q1TzRt.js";import{i as V}from"../chunks/C4LScRRF.js";import{e as ce,i as ve}from"../chunks/CPScdUsq.js";import{s as oe,r as ee}from"../chunks/CaU46lWx.js";import{b as je,a as ue}from"../chunks/8RiJpcpW.js";import{r as Ee}from"../chunks/Wcg-fE1i.js";import{s as fe}from"../chunks/BC4tm2z8.js";import"../chunks/CfIfVLxy.js";import{c as Te,I as De}from"../chunks/DC5oXhiO.js";import{n as u}from"../chunks/DxeMKRv2.js";import"../chunks/CY-IlSoc.js";var Be=(x,s,c)=>{document.getElementById(`delete_modal_${c.note.slug}`).showModal()},Le=(x,s,c)=>{document.getElementById(`delete_modal_${c.note.slug}`).close()},Ie=(x,s,c,S)=>{s(S.note),document.getElementById(`delete_modal_${S.note.slug}`).close()},Ae=w('<div role="button" tabindex="0" class="note card flex border border-base-content p-1 shadow-2xl svelte-125mjfe"><div class="card-body flex flex-col bg-base-300 p-1"><div class="title-and-options flex flex-row justify-between gap-1"><a class="note-title card-title w-full"> </a> <div class="card-options"><div class="dropdown"><div tabindex="0" role="button" class="btn btn-circle m-1 border border-base-content hover:bg-base-300"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6" type="button"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"></path></svg></div> <ul class="menu dropdown-content absolute right-8 top-8 flex flex-col gap-2 rounded-box bg-base-100 p-2 shadow-sm"><li><a class="btn btn-success">Edit <svg viewBox="0 0 24 24" fill="none" class="size-5" xmlns="http://www.w3.org/2000/svg"><path d="M21.2799 6.40005L11.7399 15.94C10.7899 16.89 7.96987 17.33 7.33987 16.7C6.70987 16.07 7.13987 13.25 8.08987 12.3L17.6399 2.75002C17.8754 2.49308 18.1605 2.28654 18.4781 2.14284C18.7956 1.99914 19.139 1.92124 19.4875 1.9139C19.8359 1.90657 20.1823 1.96991 20.5056 2.10012C20.8289 2.23033 21.1225 2.42473 21.3686 2.67153C21.6147 2.91833 21.8083 3.21243 21.9376 3.53609C22.0669 3.85976 22.1294 4.20626 22.1211 4.55471C22.1128 4.90316 22.0339 5.24635 21.8894 5.5635C21.7448 5.88065 21.5375 6.16524 21.2799 6.40005V6.40005Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M11 4H6C4.93913 4 3.92178 4.42142 3.17163 5.17157C2.42149 5.92172 2 6.93913 2 8V18C2 19.0609 2.42149 20.0783 3.17163 20.8284C3.92178 21.5786 4.93913 22 6 22H17C19.21 22 20 20.2 20 18V13" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></a></li> <li><button class="btn btn-error">Delete <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6"><path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"></path></svg></button></li></ul></div></div></div> <div class="note-meta card-actions svelte-125mjfe"><div class="badge badge-outline border border-base-content p-2"> </div> <div class="badge badge-outline border-base-content p-2"> </div> <div class="badge badge-outline border-base-content p-2"> </div></div></div></div> <dialog class="modal"><div class="modal-box"><form method="dialog"><button class="btn btn-ghost btn-sm btn-circle absolute right-2 top-2">âœ•</button></form> <h1 class="text-2xl">Delete Note</h1> <p class="py-4">Are you sure you want to delete this note?</p> <div class="modal-action"><button class="btn btn-info">Cancel</button> <button class="btn btn-error">Delete</button></div></div></dialog> <div class="note-content hidden"></div>',1);function Me(x,s){ye(s,!0);let c=Ee(s,["$$slots","$$events","$$legacy"]);async function S(j){try{localStorage.removeItem(`note:${s.note.slug}`);for(let X=0;X<u.value.length;X++)u.value[X].slug==s.note.slug&&(u.value=u.value.filter(o=>o.slug!==s.note.slug));const I=JSON.parse(atob(localStorage.getItem("user")||"{}"));if(!I.email){fe("Error","You must be logged in to delete a note",3e3,"error");return}if((await(await fetch(`${Te.apiUrl}notes/note/${j.slug}/delete`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:I.email})})).json()).status!==200){fe("Error deleting note","There was an error deleting your note from the database.",3e3,"error");return}fe("Success","Note deleted successfully",2500,"success")}catch{fe("Error deleting note","There was an error deleting your note",3e3,"error")}}var D=Ae(),N=te(D),y=r(N),J=r(y),F=r(J),k=r(F,!0);a(F);var _=d(F,2),re=r(_),U=d(r(re),2),O=r(U),ge=r(O);a(O);var se=d(O,2),me=r(se);me.__click=[Be,c,s],a(se),a(U),a(re),a(_),a(J);var le=d(J,2),Y=r(le),ne=r(Y);a(Y);var G=d(Y,2),Q=r(G,!0);a(G);var W=d(G,2),K=r(W,!0);a(W),a(le),a(y),a(N);var B=d(N,2),Z=r(B),de=d(r(Z),6),P=r(de);P.__click=[Le,c,s];var _e=d(P,2);_e.__click=[Ie,S,c,s],a(de),a(Z),a(B),ae(2),be(j=>{oe(N,"id",s.note.slug),oe(F,"href",`/home/${s.note.slug??""}/sharing`),M(k,s.note.title),oe(ge,"href",`/home/${s.note.slug}`),M(ne,`${s.note.grade??""}th grade`),M(Q,s.note.subject),M(K,j),oe(B,"id",`delete_modal_${s.note.slug??""}`)},[()=>(()=>{const j=new Date(s.note.dateCreated),I=String(j.getDate()).padStart(2,"0"),R=String(j.getMonth()+1).padStart(2,"0"),ie=String(j.getFullYear()).slice(-2);return`${R}/${I}/${ie}`})()]),m(x,D),ke()}xe(["click"]);function Je(x,s){h(s,!t(s))}var Fe=(x,s)=>{if(x.key==="Enter"&&t(s)&&t(s).length===1){const c=t(s)[0];c&&c.slug&&document.getElementById(c.slug).focus()}},Oe=w('<label class="flex cursor-pointer items-center gap-2 rounded p-1 hover:bg-base-200"><input type="radio" name="grade-filter" class="radio radio-sm"/> <span class="text-base"> </span></label>'),Ge=w('<label class="flex cursor-pointer items-center gap-2 rounded p-1 hover:bg-base-200"><input type="radio" name="subject-filter" class="radio radio-sm"/> <span class="text-base"> </span></label>'),Ze=w('<div class="filter-menu search-results mt-2 flex flex-row gap-16 rounded-md bg-base-100 p-3 shadow svelte-8wfwxf"><div class="filter-section mb-2"><span class="mb-1 block font-bold">Grade:</span> <div class="flex flex-col gap-1"><!> <label class="flex cursor-pointer items-center gap-2 rounded p-1 hover:bg-base-200"><input type="radio" name="grade-filter" class="radio radio-sm" checked/> <span class="text-base">All Grades</span></label></div></div> <div class="filter-section mb-2"><span class="mb-1 block font-bold">Subject:</span> <div class="flex flex-col gap-1"><!> <label class="flex cursor-pointer items-center gap-2 rounded p-1 hover:bg-base-200"><input type="radio" name="subject-filter" class="radio radio-sm" checked/> <span class="text-base">All Subjects</span></label></div></div></div>'),qe=(x,s)=>{event.preventDefault(),document.getElementById(t(s).slug).focus()},ze=w("<hr/>"),He=w('<a tabindex="0" class="svelte-8wfwxf"><p class="text-lg font-bold"> </p></a> <!>',1),Ve=w("<p>No notes found.</p>"),Ue=w('<div class="search-results mt-2 flex flex-col gap-2 rounded-md bg-base-100 p-2 svelte-8wfwxf"><!></div>'),Ye=w('<div class="notes-grid svelte-8wfwxf"></div>'),Qe=w('<p class="loadingNotes">Loading your Notes...</p>'),We=w('<div class="main svelte-8wfwxf"><div class="header flex gap-3 bg-base-300 p-2 svelte-8wfwxf"><div class="search-bar grow rounded-md p-1 svelte-8wfwxf"><label class="flex items-center gap-2 rounded-md p-1"><input type="text" class="search-input grow rounded-md bg-transparent svelte-8wfwxf" placeholder="Search for a note"/> <button title="Filter Notes" class="filter-notes btn btn-circle border border-base-content bg-base-100 hover:bg-base-300 svelte-8wfwxf"><!></button></label> <!> <!></div> <div class="add-note"><a class="addNoteButton btn border border-base-content bg-accent text-accent-content svelte-8wfwxf" href="/home/new-note">New Note</a></div></div> <div class="notes h-auto p-4"><!></div></div> <div class="search-button hidden svelte-8wfwxf"></div>',1);function dt(x,s){ye(s,!0);const c=[],S=[];let D=H(""),N=H(!1),y=H(void 0),J=H(!1),F,k=H("all"),_=H("all"),re="title",U=[],O=!1;async function ge(){const e=await(await fetch("/home",{method:"GET",headers:{"Content-Type":"application/json"}})).json();if(e.data&&e.data!=null&&e.data.length>0){const l=e.data.sort((f,b)=>{const n=new Date(f.dateCreated||0).getTime();return new Date(b.dateCreated||0).getTime()-n});u.value=l,me()}}async function se(){let o=[];for(let e=0;e<localStorage.length;e++){const l=localStorage.key(e);if(l!=null&&l.startsWith("note:")){O=!0;const f=localStorage.getItem(l);let b;try{const n=atob(f||""),i=new Uint8Array([...n].map(L=>L.charCodeAt(0)));b=JSON.parse(new TextDecoder().decode(i))}catch{try{b=JSON.parse(f||"{}")}catch{continue}}o.push(b)}}U=o.sort((e,l)=>{const f=new Date(e.dateCreated||e.dateCreated||0).getTime();return new Date(l.dateCreated||l.dateCreated||0).getTime()-f}),O&&(u.value=U)}async function me(){for(const o of u.value){const e=btoa(String.fromCharCode(...new TextEncoder().encode(JSON.stringify(o))));localStorage.setItem(`note:${o.slug}`,e)}}Ce(()=>{se(),ge(),document.addEventListener("click",o=>{const e=document.querySelector(".search-bar");e&&!e.contains(o.target)&&h(N,!1)})}),Se(()=>{clearTimeout(F)});function le(){t(D).length>0&&u.value?(h(N,!0),setTimeout(()=>{const o=u.value.filter(e=>e.title.toLowerCase().includes(t(D).toLowerCase())).map(e=>({title:e.title,slug:e.slug}));h(y,o,!0),console.log(t(y))},500)):(h(N,!1),h(y,[],!0))}Ne(()=>{le()});function Y(){let o=u.value;switch(t(k)&&t(k)!=="all"&&t(k)!==""&&(o=o.filter(e=>e.grade===Number(t(k)))),t(_)&&t(_)!=="all"&&t(_)!==""&&(o=o.filter(e=>e.subject===t(_))),re){case"grade":o=o.slice().sort((e,l)=>(e.grade??0)-(l.grade??0));break;case"subject":o=o.slice().sort((e,l)=>(e.subject||"").localeCompare(l.subject||""));break}return o}var ne=We(),G=te(ne),Q=r(G),W=r(Q),K=r(W),B=r(K);ee(B),B.__keydown=[Fe,y];var Z=d(B,2);Z.__click=[Je,J];var de=r(Z);De(de,{icon:"fa6-solid:filter"}),a(Z),a(K);var P=d(K,2);{var _e=o=>{var e=Ze(),l=r(e),f=d(r(l),2),b=r(f);ce(b,17,()=>Array.from(new Set(u.value.map(v=>v.grade))),ve,(v,p)=>{var E=Oe(),g=r(E);ee(g);var T,A=d(g,2),pe=r(A,!0);a(A),a(E),be(()=>{T!==(T=t(p))&&(g.value=(g.__value=t(p))??""),M(pe,t(p))}),ue(c,[],g,()=>(t(p),t(k)),he=>h(k,he)),m(v,E)});var n=d(b,2),i=r(n);ee(i),i.value=i.__value="all",ae(2),a(n),a(f),a(l);var L=d(l,2),q=d(r(L),2),z=r(q);ce(z,17,()=>Array.from(new Set(u.value.map(v=>v.subject))),ve,(v,p)=>{var E=Ge(),g=r(E);ee(g);var T,A=d(g,2),pe=r(A,!0);a(A),a(E),be(()=>{T!==(T=t(p))&&(g.value=(g.__value=t(p))??""),M(pe,t(p))}),ue(S,[],g,()=>(t(p),t(_)),he=>h(_,he)),m(v,E)});var $=d(z,2),C=r($);ee(C),C.value=C.__value="all",ae(2),a($),a(q),a(L),a(e),ue(c,[],i,()=>t(k),v=>h(k,v)),ue(S,[],C,()=>t(_),v=>h(_,v)),m(o,e)};V(P,o=>{t(J)&&o(_e)})}var j=d(P,2);{var I=o=>{var e=Ue(),l=r(e);{var f=n=>{var i=we(),L=te(i);ce(L,17,()=>t(y),ve,(q,z)=>{var $=He(),C=te($);C.__click=[qe,z];var v=r(C),p=r(v,!0);a(v),a(C);var E=d(C,2);{var g=T=>{var A=ze();m(T,A)};V(E,T=>{t(y).length>1&&T(g)})}be(()=>{oe(C,"href",`#${t(z).slug}`),M(p,t(z).title)}),m(q,$)}),m(n,i)},b=n=>{var i=Ve();m(n,i)};V(l,n=>{t(y).length>0?n(f):n(b,!1)})}a(e),m(o,e)};V(j,o=>{t(N)&&o(I)})}a(W),ae(2),a(Q);var R=d(Q,2),ie=r(R);{var X=o=>{var e=we(),l=te(e);{var f=n=>{var i=Ye();ce(i,21,Y,ve,(L,q)=>{Me(L,{get note(){return t(q)}})}),a(i),m(n,i)},b=n=>{var i=Qe();m(n,i)};V(l,n=>{u.value&&u.value.length>0?n(f):n(b,!1)},!0)}m(o,e)};V(ie,o=>{o(X,!1)})}a(R),a(G),ae(2),je(B,()=>t(D),o=>h(D,o)),m(x,ne),ke()}xe(["keydown","click"]);export{dt as component};
